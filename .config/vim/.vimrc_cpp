" Отступы
set tabstop=2
set shiftwidth=2

call plug#begin()
	Plug 'ilyachur/cmake4vim'
	Plug 'ycm-core/YouCompleteMe', { 'do': 'python3 install.py --clangd-completer' }
	Plug 'puremourning/vimspector'
	Plug 'tpope/vim-dispatch'
	Plug 'skywind3000/asyncrun.vim'
call plug#end()

" Включаю создание файл compile_commands.json с помощью cmake вызванного из
" плагина cmake4vim
let g:cmake_compile_commands = 1

" Enable a support of Vimspector in cmake4vim
let g:cmake_vimspector_support = 1

let g:cmake_ctest_args = '--output-on-failure'

function Test()
	wa

	let l:build_dir = utils#cmake#findBuildDir()
	if l:build_dir ==# ''
		call utils#common#Warning('CMake project was not found!')
		return
	endif

	let l:build_cmd = cmake4vim#SelectTarget(g:cmake_build_target)
	let l:ctest_cmd = 'ctest ' . g:cmake_ctest_args
	call utils#common#executeCommands([{'cmd': l:build_cmd, 'cwd': getcwd(), 'errFormat': ''},{'cmd': l:ctest_cmd, 'cwd': l:build_dir, 'errFormat': ''}], 1)
endfunction

command Test :call Test()

map <F2> :YcmCompleter GoTo<CR>
map qf :YcmCompleter FixIt<CR>

" Enable keys preset HUMAN in Vimspector
let g:vimspector_enable_mappings = 'HUMAN'
nmap <Leader>B <Plug>VimspectorBreakpoints

let g:ycm_complete_in_comments = 1
let g:ycm_complete_in_strings = 1
let g:ycm_collect_identifiers_from_comments_and_strings = 0

" The hack for fix the clangd bug -- fail to find stl files in /usr/include/c++/11/
let g:ycm_clangd_args = [ '--query-driver=/usr/bin/c++' ]

" Auto close annoying windows on complete
let g:ycm_autoclose_preview_window_after_completion = 1

" YCM Symbol Search
nmap <leader>yfw <Plug>(YCMFindSymbolInWorkspace)
nmap <leader>yfd <Plug>(YCMFindSymbolInDocument)

" Show doc in hover
nmap <leader>D <plug>(YCMHover)



" Сворачивание блоков
" zc - свернуть блок
" zo - развернуть блок
" zM - закрыть все блоки
" zR - открыть все блоки
" za - инвертирование
" zf - см :set foldmethod=manual
" :set foldenable - включить сворачивание
" :set foldmethod=syntax - сворачивание на основе синтаксиса
" :set foldmethod=indent - сворачивание на основе отступов
" :set foldmethod=manual - выделяем участок с помощью v и говорим zf
" :set foldmethod=marker - сворачивание на основе маркеров в тексте
" :set foldmarker=bigin,end - задаем маркеры начала и конца блока
set foldmethod=syntax


" Enable highlighting by YCM
let g:ycm_enable_semantic_highlighting=1
